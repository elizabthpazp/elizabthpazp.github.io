(function(b,a){if(typeof exports==="object"){module.exports=a()}else{if(typeof define==="function"&&define.amd){define("GMaps",[],a)}}b.GMaps=a()}(this,function(){
/*
 * GMaps.js v0.4.9
 * http://hpneo.github.com/gmaps/
 *
 * Copyright 2013, Gustavo Leon
 * Released under the MIT License.
 */
if(!(typeof window.google==="object"&&window.google.maps)){throw"Google Maps API is required. Please register the following JavaScript library http://maps.google.com/maps/api/js?sensor=true."}var f=function(o,n){var m;if(o===n){return o}for(m in n){o[m]=n[m]}return o};var j=function(n,o){var m;if(n===o){return n}for(m in o){if(n[m]!=undefined){n[m]=o[m]}}return n};var b=function(m,p){var r=Array.prototype.slice.call(arguments,2),o=[],n=m.length,q;if(Array.prototype.map&&m.map===Array.prototype.map){o=Array.prototype.map.call(m,function(s){callback_params=r;callback_params.splice(0,0,s);return p.apply(this,callback_params)})}else{for(q=0;q<n;q++){callback_params=r;callback_params.splice(0,0,m[q]);o.push(p.apply(this,callback_params))}}return o};var a=function(m){var o=[],n;for(n=0;n<m.length;n++){o=o.concat(m[n])}return o};var d=function(m,p){var n=m[0],o=m[1];if(p){n=m[1];o=m[0]}return new google.maps.LatLng(n,o)};var c=function(m,o){var n;for(n=0;n<m.length;n++){if(m[n].length>0&&typeof(m[n][0])=="object"){m[n]=c(m[n],o)}else{m[n]=d(m[n],o)}}return m};var h=function(o,m){var n,o=o.replace("#","");if("jQuery" in this&&m){n=$("#"+o,m)[0]}else{n=document.getElementById(o)}return n};var g=function(o){var m=0,n=0;if(o.offsetParent){do{m+=o.offsetLeft;n+=o.offsetTop}while(o=o.offsetParent)}return[m,n]};var i=(function(n){var m=document;var o=function(F){if(!this){return new o(F)}F.zoom=F.zoom||15;F.mapType=F.mapType||"roadmap";var K=this,u,t=["bounds_changed","center_changed","click","dblclick","drag","dragend","dragstart","idle","maptypeid_changed","projection_changed","resize","tilesloaded","zoom_changed"],s=["mousemove","mouseout","mouseover"],G=["el","lat","lng","mapType","width","height","markerClusterer","enableNewStyle"],q=F.el||F.div,B=F.markerClusterer,z=google.maps.MapTypeId[F.mapType.toUpperCase()],w=new google.maps.LatLng(F.lat,F.lng),N=F.zoomControl||true,O=F.zoomControlOpt||{style:"DEFAULT",position:"TOP_LEFT"},Q=O.style||"DEFAULT",P=O.position||"TOP_LEFT",I=F.panControl||true,A=F.mapTypeControl||true,J=F.scaleControl||true,M=F.streetViewControl||true,H=H||true,y={},v={zoom:this.zoom,center:w,mapTypeId:z},x={panControl:I,zoomControl:N,zoomControlOptions:{style:google.maps.ZoomControlStyle[Q],position:google.maps.ControlPosition[P]},mapTypeControl:A,scaleControl:J,streetViewControl:M,overviewMapControl:H};if(typeof(F.el)==="string"||typeof(F.div)==="string"){this.el=h(q,F.context)}else{this.el=q}if(typeof(this.el)==="undefined"||this.el===null){throw"No element defined."}window.context_menu=window.context_menu||{};window.context_menu[K.el.id]={};this.controls=[];this.overlays=[];this.layers=[];this.singleLayers={};this.markers=[];this.polylines=[];this.routes=[];this.polygons=[];this.infoWindow=null;this.overlay_el=null;this.zoom=F.zoom;this.registered_events={};this.el.style.width=F.width||this.el.scrollWidth||this.el.offsetWidth;this.el.style.height=F.height||this.el.scrollHeight||this.el.offsetHeight;google.maps.visualRefresh=F.enableNewStyle;for(u=0;u<G.length;u++){delete F[G[u]]}if(F.disableDefaultUI!=true){v=f(v,x)}y=f(v,F);for(u=0;u<t.length;u++){delete y[t[u]]}for(u=0;u<s.length;u++){delete y[s[u]]}this.map=new google.maps.Map(this.el,y);if(B){this.markerClusterer=B.apply(this,[this.map])}var p=function(W,X){var Y="",ac=window.context_menu[K.el.id][W];for(var Z in ac){if(ac.hasOwnProperty(Z)){var ab=ac[Z];Y+='<li><a id="'+W+"_"+Z+'" href="#">'+ab.title+"</a></li>"}}if(!h("gmaps_context_menu")){return}var S=h("gmaps_context_menu");S.innerHTML=Y;var U=S.getElementsByTagName("a"),V=U.length;Z;for(Z=0;Z<V;Z++){var T=U[Z];var R=function(af){af.preventDefault();ac[this.id.replace(W+"_","")].action.apply(K,[X]);K.hideContextMenu()};google.maps.event.clearListeners(T,"click");google.maps.event.addDomListenerOnce(T,"click",R,false)}var ad=g.apply(this,[K.el]),aa=ad[0]+X.pixel.x-15,ae=ad[1]+X.pixel.y-15;S.style.left=aa+"px";S.style.top=ae+"px";S.style.display="block"};this.buildContextMenu=function(R,S){if(R==="marker"){S.pixel={};var T=new google.maps.OverlayView();T.setMap(K.map);T.draw=function(){var V=T.getProjection(),U=S.marker.getPosition();S.pixel=V.fromLatLngToContainerPixel(U);p(R,S)}}else{p(R,S)}};this.setContextMenu=function(U){window.context_menu[K.el.id][U.control]={};var S,V=m.createElement("ul");for(S in U.options){if(U.options.hasOwnProperty(S)){var T=U.options[S];window.context_menu[K.el.id][U.control][T.name]={title:T.title,action:T.action}}}V.id="gmaps_context_menu";V.style.display="none";V.style.position="absolute";V.style.minWidth="100px";V.style.background="white";V.style.listStyle="none";V.style.padding="8px";V.style.boxShadow="2px 2px 6px #ccc";m.body.appendChild(V);var R=h("gmaps_context_menu");google.maps.event.addDomListener(R,"mouseout",function(W){if(!W.relatedTarget||!this.contains(W.relatedTarget)){window.setTimeout(function(){R.style.display="none"},400)}},false)};this.hideContextMenu=function(){var R=h("gmaps_context_menu");if(R){R.style.display="none"}};var L=function(S,R){google.maps.event.addListener(S,R,function(T){if(T==undefined){T=this}F[R].apply(this,[T]);K.hideContextMenu()})};for(var r=0;r<t.length;r++){var D=t[r];if(D in F){L(this.map,D)}}for(var r=0;r<s.length;r++){var D=s[r];if(D in F){L(this.map,D)}}google.maps.event.addListener(this.map,"rightclick",function(R){if(F.rightclick){F.rightclick.apply(this,[R])}if(window.context_menu[K.el.id]["map"]!=undefined){K.buildContextMenu("map",R)}});this.refresh=function(){google.maps.event.trigger(this.map,"resize")};this.fitZoom=function(){var S=[],T=this.markers.length,R;for(R=0;R<T;R++){if(typeof(this.markers[R].visible)==="boolean"&&this.markers[R].visible){S.push(this.markers[R].getPosition())}}this.fitLatLngBounds(S)};this.fitLatLngBounds=function(T){var U=T.length;var R=new google.maps.LatLngBounds();for(var S=0;S<U;S++){R.extend(T[S])}this.map.fitBounds(R)};this.setCenter=function(S,T,R){this.map.panTo(new google.maps.LatLng(S,T));if(R){R()}};this.getElement=function(){return this.el};this.zoomIn=function(R){R=R||1;this.zoom=this.map.getZoom()+R;this.map.setZoom(this.zoom)};this.zoomOut=function(R){R=R||1;this.zoom=this.map.getZoom()-R;this.map.setZoom(this.zoom)};var E=[],C;for(C in this.map){if(typeof(this.map[C])=="function"&&!this[C]){E.push(C)}}for(u=0;u<E.length;u++){(function(R,T,S){R[S]=function(){return T[S].apply(T,arguments)}})(this,this.map,E[u])}};return o})(this);i.prototype.createControl=function(p){var m=document.createElement("div");m.style.cursor="pointer";m.style.fontFamily="Arial, sans-serif";m.style.fontSize="13px";m.style.boxShadow="rgba(0, 0, 0, 0.398438) 0px 2px 4px";for(var o in p.style){m.style[o]=p.style[o]}if(p.id){m.id=p.id}if(p.classes){m.className=p.classes}if(p.content){m.innerHTML=p.content}for(var n in p.events){(function(r,q){google.maps.event.addDomListener(r,q,function(){p.events[q].apply(this,[this])})})(m,n)}m.index=1;return m};i.prototype.addControl=function(n){var o=google.maps.ControlPosition[n.position.toUpperCase()];delete n.position;var m=this.createControl(n);this.controls.push(m);this.map.controls[o].push(m);return m};i.prototype.createMarker=function(v){if(v.lat==undefined&&v.lng==undefined&&v.position==undefined){throw"No latitude or longitude defined."}var x=this,n=v.details,p=v.fences,w=v.outside,m={position:new google.maps.LatLng(v.lat,v.lng),map:null};delete v.lat;delete v.lng;delete v.fences;delete v.outside;var u=f(m,v),r=new google.maps.Marker(u);r.fences=p;if(v.infoWindow){r.infoWindow=new google.maps.InfoWindow(v.infoWindow);var q=["closeclick","content_changed","domready","position_changed","zindex_changed"];for(var o=0;o<q.length;o++){(function(z,y){if(v.infoWindow[y]){google.maps.event.addListener(z,y,function(A){v.infoWindow[y].apply(this,[A])})}})(r.infoWindow,q[o])}}var s=["animation_changed","clickable_changed","cursor_changed","draggable_changed","flat_changed","icon_changed","position_changed","shadow_changed","shape_changed","title_changed","visible_changed","zindex_changed"];var t=["dblclick","drag","dragend","dragstart","mousedown","mouseout","mouseover","mouseup"];for(var o=0;o<s.length;o++){(function(z,y){if(v[y]){google.maps.event.addListener(z,y,function(){v[y].apply(this,[this])})}})(r,s[o])}for(var o=0;o<t.length;o++){(function(y,A,z){if(v[z]){google.maps.event.addListener(A,z,function(B){if(!B.pixel){B.pixel=y.getProjection().fromLatLngToPoint(B.latLng)}v[z].apply(this,[B])})}})(this.map,r,t[o])}google.maps.event.addListener(r,"click",function(){this.details=n;if(v.click){v.click.apply(this,[this])}if(r.infoWindow){x.hideInfoWindows();r.infoWindow.open(x.map,r)}});google.maps.event.addListener(r,"rightclick",function(y){y.marker=this;if(v.rightclick){v.rightclick.apply(this,[y])}if(window.context_menu[x.el.id]["marker"]!=undefined){x.buildContextMenu("marker",y)}});if(r.fences){google.maps.event.addListener(r,"dragend",function(){x.checkMarkerGeofence(r,function(z,y){w(z,y)})})}return r};i.prototype.addMarker=function(n){var m;if(n.hasOwnProperty("gm_accessors_")){m=n}else{if((n.hasOwnProperty("lat")&&n.hasOwnProperty("lng"))||n.position){m=this.createMarker(n)}else{throw"No latitude or longitude defined."}}m.setMap(this.map);if(this.markerClusterer){this.markerClusterer.addMarker(m)}this.markers.push(m);i.fire("marker_added",m,this);return m};i.prototype.addMarkers=function(m){for(var n=0,o;o=m[n];n++){this.addMarker(o)}return this.markers};i.prototype.hideInfoWindows=function(){for(var m=0,n;n=this.markers[m];m++){if(n.infoWindow){n.infoWindow.close()}}};i.prototype.removeMarker=function(n){for(var m=0;m<this.markers.length;m++){if(this.markers[m]===n){this.markers[m].setMap(null);this.markers.splice(m,1);if(this.markerClusterer){this.markerClusterer.removeMarker(n)}i.fire("marker_removed",n,this);break}}return n};i.prototype.removeMarkers=function(m){var m=(m||this.markers);for(var n=0;n<this.markers.length;n++){if(this.markers[n]===m[n]){this.markers[n].setMap(null)}}var o=[];for(var n=0;n<this.markers.length;n++){if(this.markers[n].getMap()!=null){o.push(this.markers[n])}}this.markers=o};i.prototype.drawOverlay=function(n){var o=new google.maps.OverlayView(),m=true;o.setMap(this.map);if(n.auto_show!=null){m=n.auto_show}o.onAdd=function(){var p=document.createElement("div");p.style.borderStyle="none";p.style.borderWidth="0px";p.style.position="absolute";p.style.zIndex=100;p.innerHTML=n.content;o.el=p;if(!n.layer){n.layer="overlayLayer"}var s=this.getPanes(),r=s[n.layer],t=["contextmenu","DOMMouseScroll","dblclick","mousedown"];r.appendChild(p);for(var q=0;q<t.length;q++){(function(v,u){google.maps.event.addDomListener(v,u,function(w){if(navigator.userAgent.toLowerCase().indexOf("msie")!=-1&&document.all){w.cancelBubble=true;w.returnValue=false}else{w.stopPropagation()}})})(p,t[q])}google.maps.event.trigger(this,"ready")};o.draw=function(){var u=this.getProjection(),t=u.fromLatLngToDivPixel(new google.maps.LatLng(n.lat,n.lng));n.horizontalOffset=n.horizontalOffset||0;n.verticalOffset=n.verticalOffset||0;var s=o.el,p=s.children[0],q=p.clientHeight,r=p.clientWidth;switch(n.verticalAlign){case"top":s.style.top=(t.y-q+n.verticalOffset)+"px";break;default:case"middle":s.style.top=(t.y-(q/2)+n.verticalOffset)+"px";break;case"bottom":s.style.top=(t.y+n.verticalOffset)+"px";break}switch(n.horizontalAlign){case"left":s.style.left=(t.x-r+n.horizontalOffset)+"px";break;default:case"center":s.style.left=(t.x-(r/2)+n.horizontalOffset)+"px";break;case"right":s.style.left=(t.x+n.horizontalOffset)+"px";break}s.style.display=m?"block":"none";if(!m){n.show.apply(this,[s])}};o.onRemove=function(){var p=o.el;if(n.remove){n.remove.apply(this,[p])}else{o.el.parentNode.removeChild(o.el);o.el=null}};this.overlays.push(o);return o};i.prototype.removeOverlay=function(n){for(var m=0;m<this.overlays.length;m++){if(this.overlays[m]===n){this.overlays[m].setMap(null);this.overlays.splice(m,1);break}}};i.prototype.removeOverlays=function(){for(var m=0,n;n=this.overlays[m];m++){n.setMap(null)}this.overlays=[]};i.prototype.drawPolyline=function(p){var q=[],r=p.path;if(r.length){if(r[0][0]===undefined){q=r}else{for(var n=0,o;o=r[n];n++){q.push(new google.maps.LatLng(o[0],o[1]))}}}var u={map:this.map,path:q,strokeColor:p.strokeColor,strokeOpacity:p.strokeOpacity,strokeWeight:p.strokeWeight,geodesic:p.geodesic,clickable:true,editable:false,visible:true};if(p.hasOwnProperty("clickable")){u.clickable=p.clickable}if(p.hasOwnProperty("editable")){u.editable=p.editable}if(p.hasOwnProperty("icons")){u.icons=p.icons}if(p.hasOwnProperty("zIndex")){u.zIndex=p.zIndex}var s=new google.maps.Polyline(u);var t=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var m=0;m<t.length;m++){(function(w,v){if(p[v]){google.maps.event.addListener(w,v,function(x){p[v].apply(this,[x])})}})(s,t[m])}this.polylines.push(s);i.fire("polyline_added",s,this);return s};i.prototype.removePolyline=function(n){for(var m=0;m<this.polylines.length;m++){if(this.polylines[m]===n){this.polylines[m].setMap(null);this.polylines.splice(m,1);i.fire("polyline_removed",n,this);break}}};i.prototype.removePolylines=function(){for(var m=0,n;n=this.polylines[m];m++){n.setMap(null)}this.polylines=[]};i.prototype.drawCircle=function(n){n=f({map:this.map,center:new google.maps.LatLng(n.lat,n.lng)},n);delete n.lat;delete n.lng;var o=new google.maps.Circle(n),p=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var m=0;m<p.length;m++){(function(r,q){if(n[q]){google.maps.event.addListener(r,q,function(s){n[q].apply(this,[s])})}})(o,p[m])}this.polygons.push(o);return o};i.prototype.drawRectangle=function(o){o=f({map:this.map},o);var n=new google.maps.LatLngBounds(new google.maps.LatLng(o.bounds[0][0],o.bounds[0][1]),new google.maps.LatLng(o.bounds[1][0],o.bounds[1][1]));o.bounds=n;var p=new google.maps.Rectangle(o),q=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var m=0;m<q.length;m++){(function(s,r){if(o[r]){google.maps.event.addListener(s,r,function(t){o[r].apply(this,[t])})}})(p,q[m])}this.polygons.push(p);return p};i.prototype.drawPolygon=function(n){var q=false;if(n.hasOwnProperty("useGeoJSON")){q=n.useGeoJSON}delete n.useGeoJSON;n=f({map:this.map},n);if(q==false){n.paths=[n.paths.slice(0)]}if(n.paths.length>0){if(n.paths[0].length>0){n.paths=a(b(n.paths,c,q))}}var o=new google.maps.Polygon(n),p=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var m=0;m<p.length;m++){(function(s,r){if(n[r]){google.maps.event.addListener(s,r,function(t){n[r].apply(this,[t])})}})(o,p[m])}this.polygons.push(o);i.fire("polygon_added",o,this);return o};i.prototype.removePolygon=function(n){for(var m=0;m<this.polygons.length;m++){if(this.polygons[m]===n){this.polygons[m].setMap(null);this.polygons.splice(m,1);i.fire("polygon_removed",n,this);break}}};i.prototype.removePolygons=function(){for(var m=0,n;n=this.polygons[m];m++){n.setMap(null)}this.polygons=[]};i.prototype.getFromFusionTables=function(q){var n=q.events;delete q.events;var o=q,p=new google.maps.FusionTablesLayer(o);for(var m in n){(function(s,r){google.maps.event.addListener(s,r,function(t){n[r].apply(this,[t])})})(p,m)}this.layers.push(p);return p};i.prototype.loadFromFusionTables=function(n){var m=this.getFromFusionTables(n);m.setMap(this.map);return m};i.prototype.getFromKML=function(q){var r=q.url,n=q.events;delete q.url;delete q.events;var o=q,p=new google.maps.KmlLayer(r,o);for(var m in n){(function(t,s){google.maps.event.addListener(t,s,function(u){n[s].apply(this,[u])})})(p,m)}this.layers.push(p);return p};i.prototype.loadFromKML=function(n){var m=this.getFromKML(n);m.setMap(this.map);return m};i.prototype.addLayer=function(n,o){o=o||{};var m;switch(n){case"weather":this.singleLayers.weather=m=new google.maps.weather.WeatherLayer();break;case"clouds":this.singleLayers.clouds=m=new google.maps.weather.CloudLayer();break;case"traffic":this.singleLayers.traffic=m=new google.maps.TrafficLayer();break;case"transit":this.singleLayers.transit=m=new google.maps.TransitLayer();break;case"bicycling":this.singleLayers.bicycling=m=new google.maps.BicyclingLayer();break;case"panoramio":this.singleLayers.panoramio=m=new google.maps.panoramio.PanoramioLayer();m.setTag(o.filter);delete o.filter;if(o.click){google.maps.event.addListener(m,"click",function(r){o.click(r);delete o.click})}break;case"places":this.singleLayers.places=m=new google.maps.places.PlacesService(this.map);if(o.search||o.nearbySearch){var p={bounds:o.bounds||null,keyword:o.keyword||null,location:o.location||null,name:o.name||null,radius:o.radius||null,rankBy:o.rankBy||null,types:o.types||null};if(o.search){m.search(p,o.search)}if(o.nearbySearch){m.nearbySearch(p,o.nearbySearch)}}if(o.textSearch){var q={bounds:o.bounds||null,location:o.location||null,query:o.query||null,radius:o.radius||null};m.textSearch(q,o.textSearch)}break}if(m!==undefined){if(typeof m.setOptions=="function"){m.setOptions(o)}if(typeof m.setMap=="function"){m.setMap(this.map)}return m}};i.prototype.removeLayer=function(n){if(typeof(n)=="string"&&this.singleLayers[n]!==undefined){this.singleLayers[n].setMap(null);delete this.singleLayers[n]}else{for(var m=0;m<this.layers.length;m++){if(this.layers[m]===n){this.layers[m].setMap(null);this.layers.splice(m,1);break}}}};var k,l;i.prototype.getRoutes=function(n){switch(n.travelMode){case"bicycling":k=google.maps.TravelMode.BICYCLING;break;case"transit":k=google.maps.TravelMode.TRANSIT;break;case"driving":k=google.maps.TravelMode.DRIVING;break;default:k=google.maps.TravelMode.WALKING;break}if(n.unitSystem==="imperial"){l=google.maps.UnitSystem.IMPERIAL}else{l=google.maps.UnitSystem.METRIC}var m={avoidHighways:false,avoidTolls:false,optimizeWaypoints:false,waypoints:[]},o=f(m,n);o.origin=/string/.test(typeof n.origin)?n.origin:new google.maps.LatLng(n.origin[0],n.origin[1]);o.destination=/string/.test(typeof n.destination)?n.destination:new google.maps.LatLng(n.destination[0],n.destination[1]);o.travelMode=k;o.unitSystem=l;delete o.callback;delete o.error;var p=this,q=new google.maps.DirectionsService();q.route(o,function(t,u){if(u===google.maps.DirectionsStatus.OK){for(var s in t.routes){if(t.routes.hasOwnProperty(s)){p.routes.push(t.routes[s])}}if(n.callback){n.callback(p.routes)}}else{if(n.error){n.error(t,u)}}})};i.prototype.removeRoutes=function(){this.routes=[]};i.prototype.getElevations=function(n){n=f({locations:[],path:false,samples:256},n);if(n.locations.length>0){if(n.locations[0].length>0){n.locations=a(b([n.locations],c,false))}}var m=n.callback;delete n.callback;var p=new google.maps.ElevationService();if(!n.path){delete n.path;delete n.samples;p.getElevationForLocations(n,function(q,r){if(m&&typeof(m)==="function"){m(q,r)}})}else{var o={path:n.locations,samples:n.samples};p.getElevationAlongPath(o,function(q,r){if(m&&typeof(m)==="function"){m(q,r)}})}};i.prototype.cleanRoute=i.prototype.removePolylines;i.prototype.drawRoute=function(m){var n=this;this.getRoutes({origin:m.origin,destination:m.destination,travelMode:m.travelMode,waypoints:m.waypoints,unitSystem:m.unitSystem,error:m.error,callback:function(o){if(o.length>0){n.drawPolyline({path:o[o.length-1].overview_path,strokeColor:m.strokeColor,strokeOpacity:m.strokeOpacity,strokeWeight:m.strokeWeight});if(m.callback){m.callback(o[o.length-1])}}}})};i.prototype.travelRoute=function(n){if(n.origin&&n.destination){this.getRoutes({origin:n.origin,destination:n.destination,travelMode:n.travelMode,waypoints:n.waypoints,error:n.error,callback:function(q){if(q.length>0&&n.start){n.start(q[q.length-1])}if(q.length>0&&n.step){var s=q[q.length-1];if(s.legs.length>0){var u=s.legs[0].steps;for(var r=0,t;t=u[r];r++){t.step_number=r;n.step(t,(s.legs[0].steps.length-1))}}}if(q.length>0&&n.end){n.end(q[q.length-1])}}})}else{if(n.route){if(n.route.legs.length>0){var p=n.route.legs[0].steps;for(var m=0,o;o=p[m];m++){o.step_number=m;n.step(o)}}}}};i.prototype.drawSteppedRoute=function(n){var o=this;if(n.origin&&n.destination){this.getRoutes({origin:n.origin,destination:n.destination,travelMode:n.travelMode,waypoints:n.waypoints,error:n.error,callback:function(r){if(r.length>0&&n.start){n.start(r[r.length-1])}if(r.length>0&&n.step){var t=r[r.length-1];if(t.legs.length>0){var v=t.legs[0].steps;for(var s=0,u;u=v[s];s++){u.step_number=s;o.drawPolyline({path:u.path,strokeColor:n.strokeColor,strokeOpacity:n.strokeOpacity,strokeWeight:n.strokeWeight});n.step(u,(t.legs[0].steps.length-1))}}}if(r.length>0&&n.end){n.end(r[r.length-1])}}})}else{if(n.route){if(n.route.legs.length>0){var q=n.route.legs[0].steps;for(var m=0,p;p=q[m];m++){p.step_number=m;o.drawPolyline({path:p.path,strokeColor:n.strokeColor,strokeOpacity:n.strokeOpacity,strokeWeight:n.strokeWeight});n.step(p)}}}}};i.Route=function(m){this.origin=m.origin;this.destination=m.destination;this.waypoints=m.waypoints;this.map=m.map;this.route=m.route;this.step_count=0;this.steps=this.route.legs[0].steps;this.steps_length=this.steps.length;this.polyline=this.map.drawPolyline({path:new google.maps.MVCArray(),strokeColor:m.strokeColor,strokeOpacity:m.strokeOpacity,strokeWeight:m.strokeWeight}).getPath()};i.Route.prototype.getRoute=function(m){var n=this;this.map.getRoutes({origin:this.origin,destination:this.destination,travelMode:m.travelMode,waypoints:this.waypoints||[],error:m.error,callback:function(){n.route=e[0];if(m.callback){m.callback.call(n)}}})};i.Route.prototype.back=function(){if(this.step_count>0){this.step_count--;var n=this.route.legs[0].steps[this.step_count].path;for(var m in n){if(n.hasOwnProperty(m)){this.polyline.pop()}}}};i.Route.prototype.forward=function(){if(this.step_count<this.steps_length){var n=this.route.legs[0].steps[this.step_count].path;for(var m in n){if(n.hasOwnProperty(m)){this.polyline.push(n[m])}}this.step_count++}};i.prototype.checkGeofence=function(n,o,m){return m.containsLatLng(new google.maps.LatLng(n,o))};i.prototype.checkMarkerGeofence=function(o,p){if(o.fences){for(var n=0,m;m=o.fences[n];n++){var q=o.getPosition();if(!this.checkGeofence(q.lat(),q.lng(),m)){p(o,m)}}}};i.prototype.toImage=function(n){var n=n||{},p={};p.size=n.size||[this.el.clientWidth,this.el.clientHeight];p.lat=this.getCenter().lat();p.lng=this.getCenter().lng();if(this.markers.length>0){p.markers=[];for(var m=0;m<this.markers.length;m++){p.markers.push({lat:this.markers[m].getPosition().lat(),lng:this.markers[m].getPosition().lng()})}}if(this.polylines.length>0){var o=this.polylines[0];p.polyline={};p.polyline["path"]=google.maps.geometry.encoding.encodePath(o.getPath());p.polyline["strokeColor"]=o.strokeColor;p.polyline["strokeOpacity"]=o.strokeOpacity;p.polyline["strokeWeight"]=o.strokeWeight}return i.staticMapURL(p)};i.staticMapURL=function(w){var z=[],n,I="http://maps.googleapis.com/maps/api/staticmap";if(w.url){I=w.url;delete w.url}I+="?";var v=w.markers;delete w.markers;if(!v&&w.marker){v=[w.marker];delete w.marker}var K=w.styles;delete w.styles;var C=w.polyline;delete w.polyline;if(w.center){z.push("center="+w.center);delete w.center}else{if(w.address){z.push("center="+w.address);delete w.address}else{if(w.lat){z.push(["center=",w.lat,",",w.lng].join(""));delete w.lat;delete w.lng}else{if(w.visible){var L=encodeURI(w.visible.join("|"));z.push("visible="+L)}}}}var H=w.size;if(H){if(H.join){H=H.join("x")}delete w.size}else{H="630x300"}z.push("size="+H);if(!w.zoom&&w.zoom!==false){w.zoom=15}var G=w.hasOwnProperty("sensor")?!!w.sensor:true;delete w.sensor;z.push("sensor="+G);for(var y in w){if(w.hasOwnProperty(y)){z.push(y+"="+w[y])}}if(v){var u,t;for(var r=0;n=v[r];r++){u=[];if(n.size&&n.size!=="normal"){u.push("size:"+n.size);delete n.size}else{if(n.icon){u.push("icon:"+encodeURI(n.icon));delete n.icon}}if(n.color){u.push("color:"+n.color.replace("#","0x"));delete n.color}if(n.label){u.push("label:"+n.label[0].toUpperCase());delete n.label}t=(n.address?n.address:n.lat+","+n.lng);delete n.address;delete n.lat;delete n.lng;for(var y in n){if(n.hasOwnProperty(y)){u.push(y+":"+n[y])}}if(u.length||r===0){u.push(t);u=u.join("|");z.push("markers="+encodeURI(u))}else{u=z.pop()+encodeURI("|"+t);z.push(u)}}}if(K){for(var r=0;r<K.length;r++){var J=[];if(K[r].featureType&&K[r].featureType!="all"){J.push("feature:"+K[r].featureType)}if(K[r].elementType&&K[r].elementType!="all"){J.push("element:"+K[r].elementType)}for(var s=0;s<K[r].stylers.length;s++){for(var x in K[r].stylers[s]){var F=K[r].stylers[s][x];if(x=="hue"||x=="color"){F="0x"+F.substring(1)}J.push(x+":"+F)}}var E=J.join("|");if(E!=""){z.push("style="+E)}}}function A(p,M){if(p[0]==="#"){p=p.replace("#","0x");if(M){M=parseFloat(M);M=Math.min(1,Math.max(M,0));if(M===0){return"0x00000000"}M=(M*255).toString(16);if(M.length===1){M+=M}p=p.slice(0,8)+M}}return p}if(C){n=C;C=[];if(n.strokeWeight){C.push("weight:"+parseInt(n.strokeWeight,10))}if(n.strokeColor){var m=A(n.strokeColor,n.strokeOpacity);C.push("color:"+m)}if(n.fillColor){var q=A(n.fillColor,n.fillOpacity);C.push("fillcolor:"+q)}var B=n.path;if(B.join){for(var s=0,D;D=B[s];s++){C.push(D.join(","))}}else{C.push("enc:"+B)}C=C.join("|");z.push("path="+encodeURI(C))}var o=window.devicePixelRatio||1;z.push("scale="+o);z=z.join("&");return I+z};i.prototype.addMapType=function(n,o){if(o.hasOwnProperty("getTileUrl")&&typeof(o.getTileUrl)=="function"){o.tileSize=o.tileSize||new google.maps.Size(256,256);var m=new google.maps.ImageMapType(o);this.map.mapTypes.set(n,m)}else{throw"'getTileUrl' function required."}};i.prototype.addOverlayMapType=function(m){if(m.hasOwnProperty("getTile")&&typeof(m.getTile)=="function"){var n=m.index;delete m.index;this.map.overlayMapTypes.insertAt(n,m)}else{throw"'getTile' function required."}};i.prototype.removeOverlayMapType=function(m){this.map.overlayMapTypes.removeAt(m)};i.prototype.addStyle=function(m){var n=new google.maps.StyledMapType(m.styles,{name:m.styledMapName});this.map.mapTypes.set(m.mapTypeId,n)};i.prototype.setStyle=function(m){this.map.setMapTypeId(m)};i.prototype.createPanorama=function(m){if(!m.hasOwnProperty("lat")||!m.hasOwnProperty("lng")){m.lat=this.getCenter().lat();m.lng=this.getCenter().lng()}this.panorama=i.createPanorama(m);this.map.setStreetView(this.panorama);return this.panorama};i.createPanorama=function(o){var m=h(o.el,o.context);o.position=new google.maps.LatLng(o.lat,o.lng);delete o.el;delete o.context;delete o.lat;delete o.lng;var q=["closeclick","links_changed","pano_changed","position_changed","pov_changed","resize","visible_changed"],r=f({visible:true},o);for(var n=0;n<q.length;n++){delete r[q[n]]}var p=new google.maps.StreetViewPanorama(m,r);for(var n=0;n<q.length;n++){(function(t,s){if(o[s]){google.maps.event.addListener(t,s,function(){o[s].apply(this)})}})(p,q[n])}return p};i.prototype.on=function(m,n){return i.on(m,this,n)};i.prototype.off=function(m){i.off(m,this)};i.custom_events=["marker_added","marker_removed","polyline_added","polyline_removed","polygon_added","polygon_removed","geolocated","geolocation_failed"];i.on=function(m,o,n){if(i.custom_events.indexOf(m)==-1){return google.maps.event.addListener(o,m,n)}else{var p={handler:n,eventName:m};o.registered_events[m]=o.registered_events[m]||[];o.registered_events[m].push(p);return p}};i.off=function(m,n){if(i.custom_events.indexOf(m)==-1){google.maps.event.clearListeners(n,m)}else{n.registered_events[m]=[]}};i.fire=function(m,p,q){if(i.custom_events.indexOf(m)==-1){google.maps.event.trigger(p,m,Array.prototype.slice.apply(arguments).slice(2))}else{if(m in q.registered_events){var n=q.registered_events[m];for(var o=0;o<n.length;o++){(function(r,t,s){r.apply(t,[s])})(n[o]["handler"],q,p)}}}};i.geolocate=function(n){var m=n.always||n.complete;if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(o){n.success(o);if(m){m()}},function(o){n.error(o);if(m){m()}},n.options)}else{n.not_supported();if(m){m()}}};i.geocode=function(n){this.geocoder=new google.maps.Geocoder();var m=n.callback;if(n.hasOwnProperty("lat")&&n.hasOwnProperty("lng")){n.latLng=new google.maps.LatLng(n.lat,n.lng)}delete n.lat;delete n.lng;delete n.callback;this.geocoder.geocode(n,function(o,p){m(o,p)})};if(!google.maps.Polygon.prototype.getBounds){google.maps.Polygon.prototype.getBounds=function(o){var m=new google.maps.LatLngBounds();var s=this.getPaths();var r;for(var q=0;q<s.getLength();q++){r=s.getAt(q);for(var n=0;n<r.getLength();n++){m.extend(r.getAt(n))}}return m}}if(!google.maps.Polygon.prototype.containsLatLng){google.maps.Polygon.prototype.containsLatLng=function(r){var m=this.getBounds();if(m!==null&&!m.contains(r)){return false}var o=false;var s=this.getPaths().getLength();for(var u=0;u<s;u++){var v=this.getPaths().getAt(u);var t=v.getLength();var q=t-1;for(var n=0;n<t;n++){var w=v.getAt(n);var x=v.getAt(q);if(w.lng()<r.lng()&&x.lng()>=r.lng()||x.lng()<r.lng()&&w.lng()>=r.lng()){if(w.lat()+(r.lng()-w.lng())/(x.lng()-w.lng())*(x.lat()-w.lat())<r.lat()){o=!o}}q=n}}return o}}google.maps.LatLngBounds.prototype.containsLatLng=function(m){return this.contains(m)};google.maps.Marker.prototype.setFences=function(m){this.fences=m};google.maps.Marker.prototype.addFence=function(m){this.fences.push(m)};google.maps.Marker.prototype.getId=function(){return this["__gm_id"]};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(q){if(this==null){throw new TypeError()}var r=Object(this);var o=r.length>>>0;if(o===0){return -1}var p=0;if(arguments.length>1){p=Number(arguments[1]);if(p!=p){p=0}else{if(p!=0&&p!=Infinity&&p!=-Infinity){p=(p>0||-1)*Math.floor(Math.abs(p))}}}if(p>=o){return -1}var m=p>=0?p:Math.max(o-Math.abs(p),0);for(;m<o;m++){if(m in r&&r[m]===q){return m}}return -1}}return i}));